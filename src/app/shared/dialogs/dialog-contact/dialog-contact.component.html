<mat-dialog-content>
  <div class="d-flex align-items-center justify-content-between">
    <span class="fw-bold fs-5">{{ title }}</span>

    <div class="d-flex align-items-center gap-2">
      <div matRipple class="close" (click)="onCancel()">
        <i class="fa-solid fa-close"></i>
      </div>
    </div>
  </div>

  <mat-divider class="my-3"></mat-divider>

  <form [formGroup]="form">

    <div class="row">
      <div class="col-md-6">

        <div class="mb-3">
          <span class="fw-bolder">Empresa *</span>
          <mat-form-field appearance="outline">
            <input type="text" formControlName="enterprise" matInput />
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">Domínio *</span>
          <mat-form-field appearance="outline">
            <input type="text" formControlName="domain" matInput />
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">Nome do Responsável (contato) *</span>
          <mat-form-field appearance="outline">
            <input type="text" formControlName="responsible" matInput />
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">Segmento *</span>
          <mat-form-field class="example-chip-list">
            <mat-chip-grid #chipGrid aria-label="Segment Selection">
              <mat-chip-row *ngFor="let segment of segments(); trackBy: trackBySegmentId" (removed)="remove(segment)">
                {{ segment.Name }}
                <button matChipRemove [attr.aria-label]="'remove ' + segment.Name">
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            </mat-chip-grid>

            <input placeholder="Segmentos" #segmentInput [(ngModel)]="currentSegment().Name"
              [ngModelOptions]="{standalone: true}" [matChipInputFor]="chipGrid" [matAutocomplete]="auto"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (ngModelChange)="filterSegments()"
              (matChipInputTokenEnd)="add($event)" />

            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
              <mat-option *ngFor="let segment of filteredSegments(); trackBy: trackBySegmentId" [value]="segment">
                {{ segment.Name }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>





        </div>

        <div class="mb-3">
          <span class="fw-bolder">Origem *</span>
          <mat-form-field appearance="outline">
            <mat-select formControlName="origin" placeholder="Origem">
              <mat-option *ngFor="let construction of constructions" [value]="construction.id">
                {{ construction.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        @if (isAdmin) {
        <div class="mb-3">
          <span class="fw-bolder">Banco *</span>
          <mat-form-field appearance="outline">
            <mat-select formControlName="bank_id" placeholder="Banco">
              <mat-option *ngFor="let banco of bancos()" [value]="banco.id">
                {{ banco.descricao }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">Categoria *</span>
          <mat-form-field appearance="outline">
            <mat-select formControlName="category_id" placeholder="Categoria">
              <mat-option *ngFor="let category of categories()" [value]="category.id">
                {{ category.descricao }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        }

        <div class="mb-3">
          <span class="fw-bolder">Data de Retorno *</span>
          <mat-form-field appearance="outline">
            <input type="text" formControlName="return_date" matInput />
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">CNPJ *</span>
          <mat-form-field appearance="outline">
            <input type="text" formControlName="cnpj" matInput />
          </mat-form-field>
        </div>

        <div class="mb-3">
          <span class="fw-bolder">Consultor *</span>
          <mat-form-field>
            <mat-select formControlName="consultant" placeholder="Consultor">
              @for (paymentMethod of requestOrderPaymentSelection; track paymentMethod) {
              <mat-option [value]="paymentMethod">{{ paymentMethod | paymentForm }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="col-md-6">
        <!-- Itens -->
        <span class="fw-bolder">Telefones *</span>
        <div class="d-flex flex-column gap-3" formArrayName="telephones">
          @for(telephone of telephones.controls; track telephone) {
          <div class="d-flex flex-sm-row flex-column gap-1" [formGroupName]="$index">
            <div class="d-flex flex-sm-row flex-column  gap-2 w-100">
              <mat-form-field appearance="outline">
                <input matInput type="text" formControlName="number" placeholder="Número">
              </mat-form-field>
            </div>
            <div class="d-flex align-items-center">
              @if(true) {
              <button class="mt-1" color="warn" mat-icon-button (click)="onDeleteTelephone($index)">
                <i class="fa-solid fa-trash"></i>
              </button>
              }
            </div>
          </div>
          }
          <div class="col-auto">
            <div matRipple id="addItem">
              <button color="primary" *ngIf="true" (click)="!isToEdit ? pushTelephone() : null">
                <i class="fa-solid fa-plus"></i> Telefone
              </button>
            </div>
          </div>
        </div>
        <!---->
        <mat-divider class="my-3"></mat-divider>
        <!---->
        <span class="fw-bolder">E-mail *</span>
        <div class="d-flex flex-column gap-3" formArrayName="emails">
          @for(email of emails.controls; track email) {
          <div class="d-flex flex-sm-row flex-column gap-1" [formGroupName]="$index">
            <div class="d-flex flex-sm-row flex-column gap-2 w-100">
              <mat-form-field appearance="outline">
                <input matInput type="text" formControlName="email" placeholder="E-mail">
              </mat-form-field>
            </div>
            <div class="d-flex align-items-center">
              @if(true) {
              <button class="mt-1" color="warn" mat-icon-button (click)="onDeleteEmail($index)">
                <i class="fa-solid fa-trash"></i>
              </button>
              }
            </div>
          </div>
          }
          <div class="col-auto">
            <div matRipple id="addItem">
              <button color="primary" *ngIf="true" (click)="!isToEdit ? pushEmail() : null">
                <i class="fa-solid fa-plus"></i> E-mail
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="my-3">
      <span class="fw-bolder">Descrição</span>
      <mat-form-field>
        <textarea matInput formControlName="description" cdkTextareaAutosize #autosize="cdkTextareaAutosize"
          cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5" [placeholder]="'Descrição'">
        </textarea>
      </mat-form-field>
    </div>
  </form>

</mat-dialog-content>
<mat-dialog-actions>
  <div class="w-100 me-2">
    <div id="actionsDialog" class="flex-sm-row flex-column">
      @if(loading) {
      <div matRipple class="me-auto me-sm-0 mb-sm-0 mb-2 loading">
        <mat-spinner></mat-spinner>
      </div>
      }

      <div id="buttonsDialog" class="flex-sm-row flex-column">
        <div class="col-auto">
          <button matRipple id="cancel" class="button cancel" (click)="onCancel()">Cancelar</button>
        </div>
        @if(_data?.edit || isNewOrder) {
        <div class="col-auto">
          <button matRipple id="submit" class="button primary" (click)="!loading ? onConfirm() : null">{{
            "Criar"
            }}</button>
        </div>
        }
      </div>
    </div>
  </div>
</mat-dialog-actions>
